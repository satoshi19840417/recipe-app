<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„É¨„Ç∑„Éî„Çø„Ç§„Éû„Éº - „É¨„Ç∑„ÉîÂÖ±Êúâ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --tint: #FF6B35;
            --background: #FFFFFF;
            --card: #FFFFFF;
            --text: #000000;
            --secondary: #666666;
            --border: rgba(0, 0, 0, 0.1);
            --shadow: rgba(0, 0, 0, 0.1);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --tint: #FF6B35;
                --background: #151718;
                --card: #232526;
                --text: #ECEDEE;
                --secondary: #9BA1A6;
                --border: rgba(255, 255, 255, 0.1);
                --shadow: rgba(0, 0, 0, 0.3);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans JP', sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.5;
            padding-bottom: 100px;
            /* FAB/Bottom Bar space */
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            background-color: var(--background);
            border-bottom: 1px solid var(--border);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            height: 56px;
        }

        .header-title {
            font-size: 17px;
            font-weight: 600;
            text-align: center;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Content */
        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* Recipe Image */
        .recipe-image-container {
            width: 100%;
            height: 250px;
            background-color: var(--card);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .recipe-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .no-image {
            color: var(--secondary);
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .no-image-icon {
            font-size: 48px;
        }

        /* Cooking Time */
        .cooking-time-card {
            margin: 16px;
            margin-bottom: 0;
            padding: 16px;
            background-color: var(--card);
            border-radius: 12px;
            display: flex;
            align-items: center;
            box-shadow: 0 1px 4px var(--shadow);
            gap: 12px;
        }

        .cooking-time-icon {
            color: var(--tint);
            font-size: 24px;
        }

        .cooking-time-label {
            font-size: 12px;
            color: var(--secondary);
            margin-bottom: 2px;
        }

        .cooking-time-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--tint);
        }

        /* Sections */
        .section {
            padding: 24px 16px 8px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
        }

        .badge {
            background-color: var(--tint);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .shopping-hint {
            font-size: 13px;
            color: var(--secondary);
            margin-bottom: 12px;
        }

        /* Ingredients */
        .card {
            background-color: var(--card);
            border-radius: 16px;
            padding: 8px 16px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .ingredient-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            gap: 12px;
        }

        .ingredient-item:last-child {
            border-bottom: none;
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--secondary);
            border-radius: 4px;
            flex-shrink: 0;
        }

        .ingredient-info {
            flex: 1;
        }

        .ingredient-name {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .ingredient-amount {
            font-size: 14px;
            color: var(--secondary);
        }

        /* Steps */
        .step-card {
            background-color: var(--card);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .step-header {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .step-number {
            width: 32px;
            height: 32px;
            background-color: var(--tint);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
        }

        .step-desc {
            flex: 1;
            font-size: 16px;
            line-height: 1.5;
            padding-top: 4px;
        }

        .timer-btn {
            background-color: var(--tint);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 10px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            gap: 8px;
            margin-top: 12px;
            font-size: 15px;
        }

        /* Bottom Actions */
        .bottom-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card);
            padding: 16px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            box-shadow: 0 -4px 12px var(--shadow);
            z-index: 1000;
        }

        .action-btn {
            flex: 1;
            padding: 14px;
            border-radius: 50px;
            /* Pill shape */
            border: none;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            transition: opacity 0.2s;
        }

        .action-btn:active {
            opacity: 0.8;
        }

        .btn-primary {
            background-color: var(--tint);
            color: white;
        }

        .btn-secondary {
            background-color: var(--background);
            color: var(--text);
            border: 1px solid var(--border);
        }

        /* Utilities */
        .hidden {
            display: none !important;
        }

        .loading-state,
        .error-state,
        .home-state {
            padding: 48px 24px;
            text-align: center;
            color: var(--secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--tint);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Icon fonts simulation */
        .icon {
            font-family: sans-serif;
        }
    </style>
</head>

<body>
    <div id="app" class="container">
        <!-- Header -->
        <header class="header">
            <h1 id="header-title" class="header-title">„É¨„Ç∑„ÉîÂÖ±Êúâ</h1>
        </header>

        <!-- Loading -->
        <div id="loading" class="loading-state">
            <div class="spinner"></div>
            <p>„É¨„Ç∑„Éî„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
        </div>

        <!-- Home / Usage Guide (Default when no data) -->
        <div id="home" class="home-state hidden">
            <div style="font-size: 64px; margin-bottom: 24px">üì±</div>
            <h2 style="font-size: 20px; margin-bottom: 12px; color: var(--text)">„É¨„Ç∑„Éî„Çø„Ç§„Éû„Éº WebÂÖ±Êúâ</h2>
            <p style="margin-bottom: 24px; max-width: 400px; line-height: 1.6;">
                „Åì„Çå„ÅØ„É¨„Ç∑„ÉîÂÖ±ÊúâÁî®„ÅÆ„Éö„Éº„Ç∏„Åß„Åô„ÄÇ<br>
                „Ç¢„Éó„É™„ÅÆ„ÄåWeb„ÅßÂÖ±Êúâ„Äç„Éú„Çø„É≥„Åã„Çâ‰ΩúÊàê„Åï„Çå„Åü„É™„É≥„ÇØ„ÇíÈñã„Åè„Å®„ÄÅ
                „Åì„Åì„Å´„É¨„Ç∑„Éî„ÅåË°®Á§∫„Éª„Éó„É¨„Éì„É•„Éº„Åï„Çå„Åæ„Åô„ÄÇ
            </p>
            <div
                style="padding: 16px; background-color: var(--card); border-radius: 12px; border: 1px solid var(--border); width: 100%;">
                <p style="font-size: 14px;">„Ç¢„Éó„É™„Çí„ÅäÊåÅ„Å°„Åß„Å™„ÅÑÊñπ„Å∏</p>
                <div style="margin-top: 12px; display: flex; gap: 8px;">
                    <button class="action-btn btn-secondary" style="font-size: 14px; padding: 10px;">App Store</button>
                    <button class="action-btn btn-secondary" style="font-size: 14px; padding: 10px;">Google
                        Play</button>
                </div>
            </div>
        </div>

        <!-- Error -->
        <div id="error" class="error-state hidden">
            <div style="font-size: 48px; margin-bottom: 16px">üì≠</div>
            <h2>„É¨„Ç∑„Éî„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</h2>
            <p>„É™„É≥„ÇØ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Çã„Åã„ÄÅ„Éá„Éº„Çø„ÅåÁ†¥Êêç„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ</p>
        </div>

        <!-- Recipe Content -->
        <div id="recipe-content" class="hidden">
            <!-- Image Area -->
            <div class="recipe-image-container">
                <div class="no-image">
                    <span class="no-image-icon">üç≥</span>
                    <span>ÁîªÂÉè„Å™„Åó</span>
                </div>
                <!-- <img src="..." class="recipe-image" /> -->
            </div>

            <!-- Cooking Time -->
            <div id="cooking-time-section" class="cooking-time-card hidden">
                <span class="cooking-time-icon">‚è±Ô∏è</span>
                <div>
                    <div class="cooking-time-label">Á∑èË™øÁêÜÊôÇÈñì</div>
                    <div id="total-time" class="cooking-time-value">--ÂàÜ</div>
                </div>
            </div>

            <!-- Ingredients -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">ÊùêÊñô</h2>
                    <span id="ingredient-badge" class="badge">0</span>
                </div>
                <div class="shopping-hint">Ë≤∑„ÅÑÁâ©„É™„Çπ„Éà„Å®„Åó„Å¶Á¢∫Ë™ç„Åß„Åç„Åæ„Åô</div>
                <div id="ingredients-list" class="card">
                    <!-- Items injected here -->
                </div>
            </section>

            <!-- Steps -->
            <section class="section">
                <h2 class="section-title" style="margin-bottom: 12px;">Ë™øÁêÜÂ∑•Á®ã</h2>
                <div id="steps-list">
                    <!-- Steps injected here -->
                </div>
            </section>
        </div>
    </div>

    <!-- Bottom Actions -->
    <div id="bottom-actions" class="bottom-actions hidden">
        <button id="copy-btn" class="action-btn btn-secondary">„Ç≥„Éî„Éº</button>
        <a id="open-app-btn" href="#" class="action-btn btn-primary">„Ç¢„Éó„É™„ÅßÈñã„Åè</a>
    </div>

    <script>
        // --- Utilities ---
        function getRecipeData() {
            const hash = window.location.hash;
            if (!hash || !hash.startsWith('#data=')) return null;
            try {
                const encoded = hash.substring(6);
                const base64 = encoded.replace(/-/g, '+').replace(/_/g, '/');
                const padded = base64 + "=".repeat((4 - (base64.length % 4)) % 4);
                const decoded = decodeURIComponent(atob(padded));
                return JSON.parse(decoded);
            } catch (e) {
                console.error(e);
                return null;
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text || '';
            return div.innerHTML;
        }

        // --- Render Functions ---
        function render(data) {
            // Handle array or single object (currently app logic might send array)
            const recipe = Array.isArray(data) ? data[0] : data;
            if (!recipe) return;

            // Normalized Data
            const name = recipe.n || recipe.name || 'ÂêçÁß∞Êú™Ë®≠ÂÆö';
            const ingredients = recipe.i || recipe.ingredients || [];
            const steps = recipe.s || recipe.steps || [];

            // 1. Title
            document.getElementById('header-title').textContent = name;
            document.title = `${name} - „É¨„Ç∑„ÉîÂÖ±Êúâ`;

            // 2. Ingredients
            const ingList = document.getElementById('ingredients-list');
            document.getElementById('ingredient-badge').textContent = `${ingredients.length}`;

            let ingHtml = '';
            ingredients.forEach(ing => {
                const iName = ing.n || ing.name;
                const iAmount = ing.a || ing.amount;
                ingHtml += `
                    <div class="ingredient-item">
                        <div class="checkbox"></div>
                        <div class="ingredient-info">
                            <div class="ingredient-name">${escapeHtml(iName)}</div>
                            <div class="ingredient-amount">${escapeHtml(iAmount)}</div>
                        </div>
                    </div>
                `;
            });
            ingList.innerHTML = ingHtml;

            // 3. Steps
            const stepsList = document.getElementById('steps-list');
            let stepsHtml = '';
            let totalSeconds = 0;

            steps.forEach((step, i) => {
                const desc = step.d || step.description;
                const duration = step.t || step.duration || 0;
                totalSeconds += duration;

                let timerHtml = '';
                if (duration > 0) {
                    const min = Math.floor(duration / 60);
                    const sec = duration % 60;
                    const timeText = sec > 0 ? `${min}ÂàÜ${sec}Áßí` : `${min}ÂàÜ`;
                    timerHtml = `
                        <button class="timer-btn">
                            <span>‚è±Ô∏è</span>
                            <span>${timeText}</span>
                        </button>
                    `;
                }

                stepsHtml += `
                    <div class="step-card">
                        <div class="step-header">
                            <div class="step-number">${i + 1}</div>
                            <div class="step-desc">${escapeHtml(desc)}</div>
                        </div>
                        ${timerHtml}
                    </div>
                `;
            });
            stepsList.innerHTML = stepsHtml;

            // 4. Total Time
            if (totalSeconds > 0) {
                const tMin = Math.floor(totalSeconds / 60);
                document.getElementById('cooking-time-section').classList.remove('hidden');
                document.getElementById('total-time').textContent = `Á¥Ñ${tMin}ÂàÜ`;
            }

            // 5. Deep Link
            const encodedData = window.location.hash.substring(6);
            document.getElementById('open-app-btn').href = `recipetimer://sync?data=${encodedData}`;

            // Show Content
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('recipe-content').classList.remove('hidden');
            document.getElementById('bottom-actions').classList.remove('hidden');
        }

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            const hasHash = window.location.hash && window.location.hash.length > 1;

            if (hasHash) {
                const data = getRecipeData();
                if (data) {
                    render(data);
                } else {
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('error').classList.remove('hidden');
                }
            } else {
                // No hash -> Show Home/Guide
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('home').classList.remove('hidden');
                document.getElementById('header-title').textContent = "„É¨„Ç∑„Éî„Çø„Ç§„Éû„Éº";
            }

            // Copy Button Logic
            document.getElementById('copy-btn').addEventListener('click', () => {
                const data = getRecipeData();
                if (!data) return;

                const recipes = Array.isArray(data) ? data : [data];
                const fullData = recipes.map(r => ({
                    name: r.n || r.name,
                    ingredients: (r.i || r.ingredients || []).map(ing => ({
                        name: ing.n || ing.name,
                        amount: ing.a || ing.amount
                    })),
                    steps: (r.s || r.steps || []).map((step, i) => ({
                        stepNumber: i + 1,
                        description: step.d || step.description,
                        duration: step.t || step.duration
                    }))
                }));

                navigator.clipboard.writeText(JSON.stringify(fullData, null, 2))
                    .then(() => alert('„É¨„Ç∑„Éî„Éá„Éº„Çø„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü'))
                    .catch(() => alert('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'));
            });
        });
    </script>
</body>

</html>